define(["jquery","qtype_omerocommon/moodle-forms-utils"],function(a){console.log("Initialized",this),M.qtypes.omerocommon.MultilanguageElement=function(a,b){this._current_language=null,a&&(this.input_data_element_name=a),this.input_data_locale_map_name=b?b:a+"_locale_map",this._form_utils=new M.qtypes.omerocommon.MoodleFormUtils};var b=M.qtypes.omerocommon.MultilanguageElement.prototype;return b.init=function(a,b){this._locale_text_map={},console.log("Multilanguage data element: ",b),"undefined"!=typeof b&&b.length>0?this.loadDataFromFormInputs(b):this.onLanguageChanged(a);var c=this;console.log("Registering onsubmit for "+c.input_data_element_name,c),c._update_listener=function(){M.qtypes.omerocommon.MultilanguageElement.serializeToFormInputs(c),console.log("Object before submission",c)}},b.setLocaleText=function(a,b){b=b||this._current_language,console.log("Setting locale string: ",this.input_data_element_name,b,a),this._locale_text_map[b]=a},b.getLocaleText=function(a){return a=a||this._current_language,this._locale_text_map[a]},b.getLocaleTextMap=function(){var a={};for(var b in this._locale_text_map)a[b]=this._locale_text_map[b];return a},b.changeLanguage=function(a){null!==this._current_language&&this._current_language!==a&&this.save(),this._current_language=a},b.onLanguageChanged=function(a){this.changeLanguage(a)},b.clear=function(){console.warn("Not implemented at this level")},b.destroy=function(){console.log("destroying multilang element",this),document.forms[0].removeEventListener("submit",this._update_listener)},b.getLocaleTextMapElement=function(){var a=document.forms[0].elements[this.input_data_locale_map_name];return console.log("Input element name",this.input_data_locale_map_name,a),a},b.loadDataFromFormInputs=function(a){var b=document.forms[0].elements[a];if(console.log(b),b){var c=b.getAttribute("value");c&&c.length>0?this._locale_text_map=JSON.parse(c):this._locale_text_map={}}else console.error("Map element for "+a+" not found!!!")},b.saveDataToFormInputs=function(a){a=a||this.input_data_element_name,console.log("Serializing "+this.input_data_element_name+" -- "+a),this.save();var b=document.getElementsByName(a);console.log("Found input element",b);for(var c=JSON.stringify(this.getLocaleTextMap()),d=0;d<b.length;d++){var e=b[d];e.setAttribute("value",c)}console.log("After update...",b)},M.qtypes.omerocommon.MultilanguageElement.serializeToFormInputs=function(a){a.saveDataToFormInputs()},M.qtypes.omerocommon.MultilanguageElement});