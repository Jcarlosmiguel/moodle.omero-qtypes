define(["jquery","qtype_omerocommon/roi-shape-model"],function(a,b){function c(a,b){for(var c in a._event_listener_list){var d="on"+b.type.charAt(0).toUpperCase()+b.type.slice(1);console.log("Listener",c,a._event_listener_list[c],d);var e=a._event_listener_list[c][d];e&&(console.log("Calling ",e),e.call(a._event_listener_list[c],b))}}var a=jQuery;M.qtypes=M.qtypes||{},M.qtypes.omerocommon=M.qtypes.omerocommon||{},M.qtypes.omerocommon.RoiShapeTableBase=function(a,b,c){var d=this;d._table_id=a,d._table_container_toolbar_id=c||a+"-toolbar",d._table_container_id=b||a+"-container",d._event_listener_list=[]},M.qtypes.omerocommon.RoiShapeTableBase.responseHandler=function(b){return a.each(b.rows,function(b,c){c.state=-1!==a.inArray(c.id,this.selections)}),b},M.qtypes.omerocommon.RoiShapeTableBase.detailFormatter=function(b,c){var d=[];return a.each(c,function(a,b){d.push("<p><b>"+a+":</b> "+b+"</p>")}),d.join("")};var d=M.qtypes.omerocommon.RoiShapeTableBase.prototype;return d.initTable=function(b,d){var e=this;e.table_element=a("#"+e._table_id),e.remove_element=a("#remove"),e.table_container_element=a("#"+e._table_container_id),e.table_toolbar_container_element=a("#"+e._table_container_toolbar_id),b?e.hideToolbar():e.showToolbar(),e.table_element.attr("data-response-handler","M.qtypes.omerocommon.RoiShapeTableBase.responseHandler"),e.table_element.attr("data-detail-formatter","M.qtypes.omerocommon.RoiShapeTableBase.detailFormatter");var f={height:"400",columns:[[{field:"state",checkbox:!0,rowspan:2,align:"center",valign:"middle"},{title:"ID",field:"id",rowspan:2,align:"center",valign:"middle",width:"30px",sortable:!0,formatter:e.idFormatter},{title:M.util.get_string("roi_shape_details","qtype_omerocommon"),colspan:4,align:"center"}],[{field:"description",title:M.util.get_string("roi_description","qtype_omerocommon"),align:"left",formatter:e.descriptionFormatter},{field:"visible",title:M.util.get_string("roi_visibility","qtype_omerocommon"),width:"20px",align:"center",valign:"middle",events:e.eventHandler(e),formatter:e.visibilityFormatter},{field:"focusable",title:M.util.get_string("roi_focus","qtype_omerocommon"),width:"20px",align:"center",valign:"middle",events:e.eventHandler(e),formatter:e.focusAreaFormatter},{field:"answerGroup",title:M.util.get_string("roi_group","qtype_omerocommon"),align:"center",valign:"middle",width:"40px",events:e.eventHandler(e),formatter:e.answerClassFormatter}]]};f.columns[1].splice(3,1),e.table_element.bootstrapTable(f),setTimeout(function(){e.table_element.bootstrapTable("resetView")},200),e.table_element.on("click-cell.bs.table",function(a,b,d,f,g){console.log("Click on a table ROW",d,f,g),c(e,{type:"roiShapeFocus",shape:f,visible:f.visible})}),e.table_element.on("check.bs.table uncheck.bs.table check-all.bs.table uncheck-all.bs.table",function(){e.remove_element.prop("disabled",!e.table_element.bootstrapTable("getSelections").length);var a=e.getIdSelections();c(e,{type:"roiShapesSelected",shapes:a})}),e.table_element.on("expand-row.bs.table",function(b,c,d,e){c%2==1&&(e.html("Loading from ajax request..."),a.get("LICENSE",function(a){e.html(a.replace(/\n/g,"<br>"))}))}),e.table_element.on("all.bs.table",function(a,b,c){console.log(b,c)}),e.remove_element.click(function(){var a=e.getIdSelections();e.table_element.bootstrapTable("remove",{field:"id",values:a}),e.remove_element.prop("disabled",!0)}),e._initialized=!0},d.getIdSelections=function(){return a.map(this.table_element.bootstrapTable("getSelections"),function(a){return a.id})},d.selectAll=function(){this.table_element.bootstrapTable("checkAll")},d.deselectAll=function(){this.table_element.bootstrapTable("uncheckAll")},d.eventHandler=function(b){function d(d,e,f){f.visible&&f.focusable||(f.visible=!f.visible,f.visible?a(d).attr("class","green glyphicon glyphicon-eye-open"):a(d).attr("class","#E9E9E9 glyphicon glyphicon-eye-close"),c(b,{type:"roiShapeVisibilityChanged",shape:f,event:e,visible:f.visible}))}return{"click .like":function(b,c,d,e){-1!==a(b.target).attr("class").indexOf("glyphicon-plus-sign")?a(b.target).attr("class","green glyphicon glyphicon-eye-open"):a(b.target).attr("class","red glyphicon glyphicon-eye-close"),alert("You click like action, row: "+JSON.stringify(d))},"click .roi-shape-visibility":function(a,b,c,e){d(a.target,b,c)},"click .roi-shape-focusability":function(e,f,g,h){g.focusable=!g.focusable,g.focusable?a(e.target).attr("class","green glyphicon glyphicon-record"):a(e.target).attr("class","#E9E9E9 glyphicon glyphicon-record"),console.log("FOCUSability changed: "+g.focusable),c(b,{type:"roiShapeFocusabilityChanged",shape:g,event:f,focusable:g.focusable}),d(a(e.target).parents("tr").find(".roi-shape-visibility i")[0],f,g)},"click .remove":function(a,b,c,d){me.table_element.bootstrapTable("remove",{field:"id",values:[c.id]})},"change .answer-class":function(a,b,c,d){console.log(a,b,c,d),console.log("ROW: ",c),alert("Changed!!!")}}},d.addEventListener=function(a){a&&this._event_listener_list.push(a)},d.removeEventListener=function(a){if(a){var b=this._event_listener_list.indexOf(a);b>-1&&this._event_listener_list.splice(b,1)}},d.show=function(){this.table_container_element.removeClass("hidden")},d.hide=function(){this.table_container_element.addClass("hidden")},d.showToolbar=function(){this.table_toolbar_container_element.removeClass("hidden")},d.hideToolbar=function(){this.table_toolbar_container_element.addClass("hidden")},d.idFormatter=function(a){return['<span class="highlight-roi">',a,"</span>"].join(" ")},d.totalNameFormatter=function(a){return a.length},d.totalNameFormatter=function(a){return a.length},d.descriptionFormatter=function(a){return a||" "},d.visibilityFormatter=function(a){return['<a class="roi-shape-visibility" href="javascript:void(0)" title="Visibility">',a?'<i class="green glyphicon glyphicon-eye-open"></i>':'<i class="#E9E9E9 glyphicon glyphicon-eye-close"></i>',"</a> "].join(" ")},d.focusAreaFormatter=function(a){return['<a class="roi-shape-focusability" href="javascript:void(0)" title="Focusability">',a?'<i class="green glyphicon glyphicon-record"></i>':'<i class="#E9E9E9 glyphicon glyphicon-record"></i>',"</a> "].join(" ")},d.answerClassFormatter=function(a,b,c){return['<select class="answer-class form-control">',"<option>1</option>","<option>2</option>","<option>3</option>","<option>4</option>","</select>"].join("")},d.getHeight=function(){return a(window).height()-a("h1").outerHeight(!0)},d.getBootstrapTable=function(){return this.table_element.bootstrapTable},d.appendRoiShapeList=function(a){return this.table_element.bootstrapTable("append",a)},d.setRoiShapeList=function(a){this.removeAll(),this.appendRoiShapeList(a)},d.getRoiShape=function(a){return this.table_element.bootstrapTable("getRowByUniqueId",a)},d.getRoiShapeList=function(){return this.table_element.bootstrapTable("getData")},d.removeRoiShape=function(a){return a=a instanceof Array?a:[a],this.table_element.bootstrapTable("remove",{field:"id",values:a})},d.removeAll=function(){return this.table_element.bootstrapTable("removeAll")},M.qtypes.omerocommon.RoiShapeTableBase});