define(["jquery","qtype_omerocommon/moodle-forms-utils","qtype_omerocommon/question-editor-base","qtype_omerointeractive/answer-group"],function(a,b,c){function d(b,c){c||(c=b.getSelectedROIIds());var d=c.length>0;if(d){var e=b._add_to_group_list_element;e.html(""),d=!1;for(var f in b._answers){var g=b._answers[f];if(g.containsROIs(b.getSelectedROIIds()))break;var h=a('<li value="'+f+'"><a href="#">'+(parseInt(f)+1)+"</a></li>");d=!0,e.append(h),h.click(function(){var c=a(this).attr("value");console.log("Selected ROI GROUP: "+c);var d=b.getSelectedROIIds();d&&d.length>0&&b._answers[c].addROIsToGroup(d)})}}d?b._add_to_group_element.removeClass("disabled"):b._add_to_group_element.addClass("disabled")}console.log("Initialized",this),M.qtypes=M.qtypes||{},M.qtypes.omerointeractive=M.qtypes.omerointeractive||{},M.qtypes.omerointeractive.QuestionEditorInteractive=function(){M.qtypes.omerocommon.QuestionEditorBase.call(this)},M.qtypes.omerointeractive.QuestionEditorInteractive.prototype=new M.qtypes.omerocommon.QuestionEditorBase,M.qtypes.omerointeractive.QuestionEditorInteractive.prototype.constructor=M.qtypes.omerointeractive.QuestionEditorInteractive,M.qtypes.omerointeractive.QuestionEditorInteractive.prototype.parent=M.qtypes.omerocommon.QuestionEditorBase.prototype;var e=M.qtypes.omerointeractive.QuestionEditorInteractive.prototype;return M.qtypes.omerointeractive.QuestionEditorInteractive.getInstance=function(){return M.qtypes.omerocommon.QuestionEditorBase.instance||(M.qtypes.omerocommon.QuestionEditorBase.instance=new M.qtypes.omerointeractive.QuestionEditorInteractive),M.qtypes.omerocommon.QuestionEditorBase.instance},e.initialize=function(b,c,d,e){this.parent.initialize.call(this,b,c),this._show_roishape_column_group=!0,this._add_to_group_element_id=d,this._add_to_group_element=a("#"+d),this._add_to_group_list_element_id=e,this._add_to_group_list_element=a("#"+e),this._add_to_group_list_element.dropdown()},e.buildAnswer=function(a,b,c){return new M.qtypes.omerointeractive.AnswerGroup(this._answers_section_id,a,b,c)},e.onAddAnswer=function(a){console.log("Added answer",a),a._init_roi_list(),a.updateROIList(),a.addListener(this),d(this)},e.onRemoveAnswer=function(a){console.log("Removed answer",a),a.removeListener(this),d(this)},e.onRoiShapesSelected=function(a){console.log("ROI Shape selected...",a),d(this,a.shapes)},e.onAnswerROIsAdded=function(a){console.log("Added new ROIs ",a),this._roi_shape_table.deselectAll()},e.onAnswerROIsRemoved=function(a){console.log("Removed new ROIs ",a),d(this)},e.validate=function(){var a=this.parent.validate.call(this);try{for(var b in this._answers){var c=this._answers[b];if(c&&0==c._roi_id_list){a.push(M.util.get_string("validation_noroi_per_group","qtype_omerointeractive"));break}}}catch(d){console.error(d),a.push(d.message)}return a},M.qtypes.omerointeractive.QuestionEditorInteractive.main=function(b,c,d,e){console.log(c),a(document).ready(function(){var a=M.qtypes.omerointeractive.QuestionEditorInteractive.getInstance();a.initialize(b,c,d,e),window.qei=a})},M.qtypes.omerointeractive.QuestionEditorInteractive});